<!DOCTYPE html>
<html>
    <head>
        <title>My DC Example</title>
        <meta http-equiv="content-type" content="text/html; charset=UTF8">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <link href="https://cdn.jsdelivr.net/npm/dc@4.2.7/dist/style/dc.css" rel="stylesheet">
        <style>
            pre#data {
                display: none;
            }
        </style>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.js" type="text/javascript"></script>
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.min.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/dc@4.2.7/dist/dc.min.js"></script>
            </head>
    <body>
        <h1>My DC Example</h1>
        <p>This is a DC example.</p>
        <table>
            <tr>
                <td><div id="chart-ring-totals"></div></td>
                <td><div id="chart-line-deaths"></div></td>
            </tr>

        </table>


        <div style='clear:both;'>
            <table id="dc-data-table" style="border: 2px solid gray; align:center;padding: 50px;">
                <thead>
                <tr class="header">
                    <th>Date</th>
                    <th>TPS 200</th>
                    <th>TPS 302</th>
                    <th>TPS 404</th>
                    <th>TPS Total</th>
                </tr>
                </thead>
            </table>
        </div>

        <script>
            //-----------------------------------------------------
            // Fetches the data from the server
            //-----------------------------------------------------
            async function fetchData(url) {
                var jsonData = [];
                var response = await fetch(url);
                var data = await response.json();
                data.forEach(element => {
                jsonData.push(element);
                });
                console.log(jsonData);
                return jsonData;
            }

            //-----------------------------------------------------
            // Prints the data to the console.
            //-----------------------------------------------------
            function print_filter(filter) {
                var f=eval(filter);
                if (typeof(f.length) != "undefined") {}else{}
                if (typeof(f.top) != "undefined") {f=f.top(Infinity);}else{}
                if (typeof(f.dimension) != "undefined") {f=f.dimension(function(d) { return "";}).top(Infinity);}else{}
                console.log(filter+"("+f.length+") = "+JSON.stringify(f).replace("[","[\n\t").replace(/}\,/g,"},\n\t").replace("]","\n]"));
            }

            var data = fetchData("https://data.cdc.gov/resource/9bhg-hcku.json");
            data
                .then(x => {
                    var ndx = crossfilter(x);
                    var sexDim = ndx.dimension((d) => (d.sex));
                    print_filter(sexDim);
                })

            // var parseDate = d3.timeParse("%m/%d/%Y");
            // data.forEach(function(d) {
            //     d.date = parseDate(d.date);
            //     d.total= d.http_404+d.http_200+d.http_302;
            //     d.Year=d.date.getFullYear();
            // });
            // print_filter("data");

            // var datatable   = dc.dataTable("#dc-data-table");
            // datatable
            //     .dimension(dateDim)
            //     .group(function(d) {return d.Year;})
            //     // dynamic columns creation using an array of closures
            //     .columns([
            //         function(d) { return "<i>"+(d.date.getMonth() + 1) + "/" + d.date.getDate() + "/" +  d.date.getFullYear() + "</i>"; },
            //         function(d) {return d.http_200;},
            //         function(d) {return d.http_302;},
            //         function(d) {return d.http_404;},
            //         function(d) {return d.total;}
            //     ]);
            // dc.renderAll();
        </script>
    </body>
</html>